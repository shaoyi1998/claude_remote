# Claude Remote 启动指南

## 环境要求

- Linux 服务器（推荐 Ubuntu 22.04）或 WSL2
- Node.js 18+
- Python 3.10+
- tmux (`sudo apt install tmux`)

## 快速启动

### 1. 克隆项目

```bash
git clone https://github.com/shaoyi1998/claude_remote.git
cd claude_remote
```

### 2. 启动后端

```bash
cd backend

# 安装依赖
pip install -r requirements.txt

# 复制环境配置（生产环境请修改 SECRET_KEY）
cp .env.example .env

# 启动服务
python3 -m uvicorn main:app --host 0.0.0.0 --port 8000
```

### 3. 启动前端

```bash
cd frontend

# 安装依赖
npm install

# 启动开发服务器
npm run dev
```

### 4. 访问应用

- 本机访问: http://localhost:3000
- 局域网访问: http://<服务器IP>:3000

### 5. 初始化账号

首次使用需要初始化管理员账号：
1. 访问 http://localhost:3000/login
2. 点击「初始化管理员」按钮
3. 使用默认账号 `admin` 登录（默认密码见提示）
4. **登录后请立即修改密码**

## 生产环境部署

### 环境变量配置

编辑 `backend/.env`：

```ini
# JWT 密钥（务必修改为随机字符串！）
SECRET_KEY=your-random-secret-key-at-least-32-chars

# Token 过期时间（分钟）
ACCESS_TOKEN_EXPIRE_MINUTES=10080

# CORS 允许的来源（生产环境设置具体域名）
CORS_ORIGINS=https://your-domain.com

# 数据库路径
DATABASE_URL=sqlite:///./claude_remote.db
```

### 使用 Gunicorn + Nginx

```bash
# 安装 Gunicorn
pip install gunicorn

# 启动后端（4 个 worker）
gunicorn main:app -w 4 -k uvicorn.workers.UvicornWorker -b 0.0.0.0:8000
```

### 前端构建

```bash
cd frontend
npm run build
```

构建产物在 `frontend/dist/` 目录，由 Nginx 托管。

## WSL2 网络配置（Windows 用户）

如果使用 WSL2 运行后端，需要配置镜像网络模式以支持局域网访问。

### 配置 .wslconfig

创建或编辑 `C:\Users\{用户名}\.wslconfig`：

```ini
[wsl2]
memory=524288000000
swap=17301504000
networkingMode=mirrored
autoProxy=true
[experimental]
hostAddressLoopback=true
```

> **重要**：`hostAddressLoopback=true` 是必须的，否则 Windows 无法通过局域网 IP 访问 WSL 服务。

### 重启 WSL

```powershell
wsl --shutdown
```

### Windows 防火墙

```powershell
# 管理员权限运行
netsh advfirewall firewall add rule name="Claude Remote" dir=in action=allow protocol=tcp localport=8000-9000
```

## 一键启动脚本

### Linux/WSL (start.sh)

```bash
#!/bin/bash
cd "$(dirname "$0")"

# 启动后端
cd backend
python3 -m uvicorn main:app --host 0.0.0.0 --port 8000 &
BACKEND_PID=$!

# 启动前端
cd ../frontend
npm run dev &

echo "后端 PID: $BACKEND_PID"
echo "访问地址: http://localhost:3000"
wait
```

## 常见问题

### 端口被占用

```bash
# 查找占用进程
lsof -i :8000

# 杀掉进程
kill -9 <PID>
```

### tmux 未安装

```bash
sudo apt update
sudo apt install tmux
```

### 局域网无法访问

1. 检查防火墙是否开放端口
2. 确认后端绑定的是 `0.0.0.0` 而不是 `127.0.0.1`
3. WSL 用户检查 `.wslconfig` 配置
4. **WSL 用户**：确保 `.wslconfig` 中 `hostAddressLoopback=true` 已启用
5. **WSL 用户**：检查 Windows 设置 → 隐私和安全性 → 开发者选项，确保"主机地址环回"已开启

## 依赖版本

```
# Python
fastapi>=0.109.0
uvicorn[standard]>=0.27.0
sqlalchemy>=2.0.25
python-jose[cryptography]>=3.3.0
passlib[bcrypt]>=1.7.4
python-multipart>=0.0.6
pydantic>=2.5.3
pydantic-settings>=2.1.0
aiofiles>=23.2.1
libtmux>=0.23.2
httpx>=0.27.0
websockets>=12.0

# Node.js
vue: ^3.4.0
xterm: ^5.3.0
xterm-addon-fit: ^0.8.0
```

## 检查清单

- [ ] Python 3.10+ 已安装
- [ ] Node.js 18+ 已安装
- [ ] tmux 已安装
- [ ] 后端依赖已安装
- [ ] 前端依赖已安装
- [ ] .env 文件已配置
- [ ] 管理员账号已初始化
- [ ] 密码已修改
